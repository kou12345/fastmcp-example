# MCP ローカルファイル操作ツール追加タスク

## PRD

- [prd.md](prd.md) を参照

## 実装タスク

- [ ] **`list_directory` ツールの実装 (`main.py`)**

  - [ ] `os.listdir()` を使用してディレクトリ内容を取得
  - [ ] 引数 `dir_path` が `is_path_allowed` で許可されたディレクトリであることを検証
  - [ ] パスがファイルでないこと、ディレクトリが存在することを確認
  - [ ] 成功時はファイル/ディレクトリ名のリストを返す
  - [ ] 適切なエラーメッセージを返す
  - [ ] `@mcp.tool()` デコレータと適切な docstring を追加

- [ ] **`find_files_by_pattern` ツールの実装 (`main.py`)**

  - [ ] `glob.glob()` または `pathlib.Path.glob()` を使用してパターンに一致するパスを検索
  - [ ] 引数 `base_dir` が `is_path_allowed` で許可されたディレクトリであることを検証
  - [ ] `recursive` 引数に応じて再帰検索を制御
  - [ ] 成功時は見つかったパスのリストを返す (許可範囲内のパスのみ)
  - [ ] 適切なエラーメッセージを返す
  - [ ] `@mcp.tool()` デコレータと適切な docstring を追加

- [ ] **`search_content_in_files` ツールの実装 (`main.py`)**

  - [ ] 引数 `search_path` が `is_path_allowed` で許可されたパス（ファイルまたはディレクトリ）であることを検証
  - [ ] `search_path` がディレクトリの場合:
    - [ ] `os.walk()` または `pathlib` を使用してファイルリストを取得 (`recursive` 引数を考慮)
    - [ ] 各ファイルが `is_path_allowed` の範囲内であることを確認
  - [ ] `search_path` がファイルの場合、そのファイルのみを対象とする
  - [ ] 対象ファイルの各行を読み込み (`encoding='utf-8'` を指定)、`re.search()` で `regex_pattern` を検索
  - [ ] `regex_pattern` のバリデーション（不正な正規表現でないか `try-except` で確認）
  - [ ] 一致した場合、`"ファイルパス:行番号:一致した行の内容"` の形式で結果リストに追加
  - [ ] 結果が `max_results` を超えたら検索を打ち切る
  - [ ] 成功時は結果リストを返す
  - [ ] 適切なエラーメッセージを返す (ファイル読み取りエラー、PermissionError、不正なパターン等)
  - [ ] `@mcp.tool()` デコレータと適切な docstring を追加

- [ ] **テスト**
  - [ ] 各ツールが正常に動作することを確認
  - [ ] 許可されていないパスへのアクセスが拒否されることを確認
  - [ ] エッジケース（空ディレクトリ、パターンに一致するファイルがない等）を確認
  - [ ] エラーハンドリングが正しく機能することを確認
